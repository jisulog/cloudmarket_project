{% extends 'base.html' %}


{% block content %}
<!-- 검색 창 -->
<div class="row justify-content-end my-3">
    <div class="col-4 input-group">
        <input type="text" class="form-control kw" value="{{ kw|default_if_none:'' }}">
        <div class="input-group-append">
            <button class="btn btn-outline-secondary" type="button" id="btn_search">찾기</button>
        </div>
    </div>
</div>
<h3>{{ post.post_title }}</h3>
{{ post.user_id.last_name }}<br>
{% if post.modify_date %}
<div class="badge badge-light p-2 text-left mx-3">
    <div>{{ post.modify_date }}(수정)</div>
</div>
{% else %}
<div class="badge badge-light p-2 text-left mx-3">
    <div>{{ post.create_date }}</div>
</div>
{% endif %}
<div>
    {% if post.image %}
    <img src="{{ post.image.url }}" alt="{{ post.image }}">
    <!--resize height="300" width="500"-->
    {% else %}
    <p>이미지가 없습니다</p>
    {% endif %}
    <p>{{ post.content }}</p>
    <p>{{ post.price }}원</p>
</div>

<div>
{% if request.user == post.user_id %}
<a href="{% url 'market:postupdate' post.id  %}">수정</a>
<a href="{% url 'market:postdelete' post.id  %}">삭제</a>
{% endif %}
</div>


<div>
    <h5>{{post.comment_set.count}}개의 댓글이 있습니다.</h5>
    <div>
        
            {% for comment in post.comment_set.all %}
        <ul>
            <li>{{ comment.user_id.last_name }}

            <div class="d-flex justify-content-end"></div>
            {% if comment.modify_date %}
            <div class="badge badge-light p-2 text-left mx-3">
                <div>{{ comment.modify_date }}(수정)</div>
            </div>
            {% endif %}
            <div class="badge badge-light p-2">
                {{ comment.create_date }} </li>
            </div>

            <li>{{ comment.content }}</li>
        </ul>
            <div>
                {% if request.user == comment.user_id %}
                    <a href="{% url 'market:commentupdate' comment.id  %}">수정</a>
                    <a href="{% url 'market:commentdelete' comment.id  %}">삭제</a>
                {% endif %}
            </div>
            {% endfor %}
        
    </div>
            

    <form action="{% url 'market:commentcreate' post.id  %}" method="post" {% if not user.is_authenticated %}hidden{% endif %}>
        {% csrf_token %}
        {% include "form_errors.html" %}
        <textarea name="content" id="content" rows="5" value="{{ form.username.value|default_if_none:'' }}" required></textarea>
        <input type="submit" value="댓글 등록">
    </form>

</div>


<form action="{% url 'market:commentcreate' post.id  %}" method="post" {% if not user.is_authenticated %}hidden{% endif %}>
    {% csrf_token %}
    {% include "form_errors.html" %}
    <textarea name="content" id="content" rows="5" value="{{ form.username.value|default_if_none:'' }}" required></textarea>
    <input type="submit" value="답변등록">
</form>

<!-- 검색 폼  -->
<form id="searchForm" method="get" action="{% url 'market:postlist' %}">
    <input type="hidden" id="kw" name="kw" value="{{ kw|default_if_none:'' }}">
    <input type="hidden" id="page" name="page" value="{{ page }}">
</form>

{% endblock %}
{% block script %}
<script type='text/javascript'>
//console.log('자바스크립트 초입');
//document.write('자바스크립트 초입');
$(document).ready(function(){
    $(".page-link").on('click', function() {
        $("#page").val($(this).data("page"));
        $("#searchForm").submit();
    });

    $("#btn_search").on('click', function() {
        //console.log('버튼 입력');
        //document.write('버튼 입력');
        $("#kw").val($(".kw").val());
        $("#page").val(1);  // 검색버튼을 클릭할 경우 1페이지부터 조회한다.
        $("#searchForm").submit();
    });
});
</script>
{% endblock %}
